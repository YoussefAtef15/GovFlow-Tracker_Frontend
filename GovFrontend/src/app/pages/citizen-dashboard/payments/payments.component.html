<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<div class="page-container">
<div *ngIf="loading" class="loading-state">
  <div class="spinner"></div>
  <p>Loading payment details...</p>
</div>

<div *ngIf="error" class="error-state">
  <i class="fas fa-exclamation-circle"></i>
  <p>{{ error }}</p>
</div>

<div *ngIf="!loading && !error && currentPayment && userProfile" class="payment-container">
  <div class="payment-layout">
    <!-- Left Column - Summary and History -->
    <div class="payment-summary">
      <div class="summary-card">
        <div class="summary-header">
          <p class="summary-title">TOTAL RECEIVED</p>
          <p class="summary-amount">
            <span class="currency">EGP</span>84,254
            <span class="decimal">.58</span>
          </p>
          <span class="growth-badge">
            <i class="fas fa-arrow-up"></i>+10% since last month
          </span>
        </div>
        <div class="summary-details">
          <div class="detail-item">
            <span class="status-indicator pending"></span>
            <div>
              <p class="detail-label">Pending</p>
              <p class="detail-value">EGP 1,254.50</p>
            </div>
          </div>
          <div class="detail-item">
            <span class="status-indicator drafts"></span>
            <div>
              <p class="detail-label">On drafts</p>
              <p class="detail-value">EGP 0.00</p>
            </div>
          </div>
        </div>
      </div>

      <div class="history-card">
        <div class="card-header">
          <h3>Payment History</h3>
        </div>
        <div class="history-list">
          <div *ngFor="let item of paymentHistory" class="history-item">
            <div class="history-info">
              <p class="service-name">{{ item.serviceName }}</p>
              <p class="payment-date">{{ item.date | date:'mediumDate' }}</p>
            </div>
            <p class="payment-amount">{{ item.amount | currency:'EGP ' }}</p>
          </div>
          <div *ngIf="paymentHistory.length === 0" class="no-history">
            <p>No payment history found</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column - Payment Form -->
    <div class="payment-form">
      <div class="form-card">
        <div class="form-section">
          <label for="serviceSelect">Select Service to Pay:</label>
          <select id="serviceSelect" [(ngModel)]="selectedServiceId" (change)="updatePaymentDetails()">
            <option *ngFor="let service of payableServices" [value]="service.id">
              {{ service.name }} - {{ service.amount | currency:'EGP ' }}
            </option>
          </select>
        </div>

        <div class="invoice-section">
          <h4>Invoice</h4>
          <div class="invoice-address">
            <p class="customer-name">{{ userProfile.name || 'Customer Name' }}</p>
            <p>{{ userProfile.addressLine1 || 'Address Line 1' }}</p>
            <p *ngIf="userProfile.addressLine2">{{ userProfile.addressLine2 }}</p>
          </div>

          <div class="invoice-details">
            <table>
              <thead>
              <tr>
                <th>Items</th>
                <th>Qty</th>
                <th>Price</th>
                <th>Total</th>
              </tr>
              </thead>
              <tbody>
              <tr>
                <td>{{ currentPayment.serviceName }}</td>
                <td>1</td>
                <td>{{ currentPayment.processingFee | currency:'EGP ' }}</td>
                <td>{{ currentPayment.processingFee | currency:'EGP ' }}</td>
              </tr>
              <tr>
                <td>Service Fee</td>
                <td>1</td>
                <td>{{ currentPayment.serviceFee | currency:'EGP ' }}</td>
                <td>{{ currentPayment.serviceFee | currency:'EGP ' }}</td>
              </tr>
              </tbody>
            </table>
          </div>

          <div class="invoice-total">
            <p>Total Amount</p>
            <p class="total-amount">{{ currentPayment.totalAmount | currency:'EGP ' }}</p>
          </div>

          <p class="disclaimer">This is a demo payment for government services. No real money will be charged.</p>
        </div>

        <div class="payment-section">
          <h4>Pay this Invoice</h4>
          <p class="section-description">Make payment for this invoice by filling in the details</p>

          <form (ngSubmit)="processPayment($event)">
            <div class="form-group">
              <label for="cardNumber">Card Number</label>
              <div class="input-with-icon">
                <i class="far fa-credit-card"></i>
                <input
                  id="cardNumber"
                  type="text"
                  placeholder="1234 5678 9012 3456"
                  [(ngModel)]="cardNumber"
                  (input)="formatCardNumber()"
                  name="cardNumber"
                  maxlength="19">
                <span class="card-type-icon" *ngIf="cardType !== 'unknown'">
                  <i [class]="'fab fa-cc-' + cardType"></i>
                  <span class="card-type-name">{{ getCardTypeName() }}</span>
                </span>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="expiryDate">Expiry Date</label>
                <input
                  id="expiryDate"
                  type="text"
                  placeholder="MM/YY"
                  [(ngModel)]="expiryDate"
                  (input)="formatExpiryDate()"
                  name="expiryDate"
                  maxlength="5">
              </div>
              <div class="form-group">
                <label for="cvv">CVV</label>
                <input
                  id="cvv"
                  type="password"
                  placeholder="123"
                  [(ngModel)]="cvv"
                  name="cvv"
                  maxlength="4">
              </div>
            </div>

            <button type="submit" class="pay-button" [disabled]="!isFormValid()">
              PAY {{ currentPayment.totalAmount | currency:'EGP ' }}
              <i class="fas fa-arrow-right"></i>
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
